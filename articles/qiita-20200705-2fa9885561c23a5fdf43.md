---
title: "CUDA on WSLã®å®Ÿè¡Œé€Ÿåº¦ã‚’Google Colaboratoryã¨æ¯”è¼ƒã—ã¦ã¿ãŸ"
emoji: "ğŸ˜€"
type: "idea"
topics: [CUDA,WSL,GoogleColaboratory,NeuralVocoder]
published: true
---
æ·±å±¤å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã§å‹•ã‹ã—ã¦ã¿ãŸã„ãƒªãƒã‚¸ãƒˆãƒªãŒã‚ã£ãŸã®ã ãŒï¼Œã©ã†ã«ã‚‚Linuxç’°å¢ƒã§ãªã„ã¨å®Ÿè¡Œã§ããªã•ãã†ã§ã‚ã£ãŸï¼ãã®ãŸã‚ï¼Œãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã«[CUDA on WSL](https://docs.nvidia.com/cuda/wsl-user-guide/index.html)ã‚’å°å…¥ã—ã¦ã¿ãŸã‚‚ã®ã®ï¼Œã¡ã‚‡ã£ã¨è¨ˆç®—ãŒé…ã„ã‹ãªã¨æ„Ÿã˜ã¦ã„ãŸï¼ãã“ã§ï¼Œ[Google Colaboratory](https://colab.research.google.com/notebooks/welcome.ipynb?hl=ja)ã§å‹•ã‹ã—ã¦ã¿ã‚‹ã“ã¨ã«ã—ãŸï¼ã›ã£ã‹ããªã®ã§ï¼Œã“ã®2ã¤ã®ç’°å¢ƒã§ã©ã®ç¨‹åº¦è¨ˆç®—é€Ÿåº¦ã«å·®ãŒå‡ºã‚‹ã®ã‹æ¯”è¼ƒã—ã¦ã¿ãŸï¼

# å®Ÿè¡Œã—ãŸãƒªãƒã‚¸ãƒˆãƒª

- https://github.com/nii-yamagishilab/project-NN-Pytorch-scripts

[å‰ã«ç´¹ä»‹ã—ãŸ](https://qiita.com/mitsu-h/items/261868e245c888ba4e76)Neural Source Filterã®ç™ºå±•ç‰ˆã®Pytorchå®Ÿè£…ã§ã‚ã‚‹ï¼å®Ÿè¡ŒãŒã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§è¨˜è¿°ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚‚ã‚ã‚Šï¼ŒLinuxã§å‹•ä½œã•ã›ãŸã»ã†ãŒç¾å®Ÿçš„ã§ã‚ã‚‹ã¨åˆ¤æ–­ã—ãŸï¼
## Google Colaboratoryã§ã®å®Ÿè¡Œæ–¹æ³•
ãƒªãƒã‚¸ãƒˆãƒªã‚ˆã‚Š
>Take cyc-noise-nsf as an example:

```
# add $PWD to PYTHONPATH 
# you may also activate conda environment
$: bash env.sh 

# cd into the project and run the script
$: cd project/cyc-noise-nsf-4
$: bash 00_demo.sh
```

ã¨å®Ÿè¡Œã™ã‚‹ã¨ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼Œå­¦ç¿’æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«ã‚’ç”¨ã„ãŸæ³¢å½¢ç”Ÿæˆï¼Œå­¦ç¿’ã¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã‚Œã‚‹ï¼ä»Šå›ã¯

- [Google Driveã«ãƒªãƒã‚¸ãƒˆãƒªã‚’Clone](https://qiita.com/tamitarai/items/1c9da94fdfad997c3336)
- `!pip install numpy --upgrade`ã‚’è¡Œã†ï¼ˆã—ãªã„ã¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œæ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ï¼‰

ã‚’è¡Œã„ï¼Œä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè¡Œã—ãŸï¼ãƒªãƒã‚¸ãƒˆãƒªã®é…ç½®ã¯ãŠå¥½ããªã‚ˆã†ã«ã©ã†ã

```
%cd /content/gdrive/My\ Drive/neural_source_filter/neural_source_filter/ #ãƒªãƒã‚¸ãƒˆãƒªã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
!bash env.sh
%cd ./project/cyc-noise-nsf-4/
!bash 00_demo.sh
```

# ã‚¹ãƒšãƒƒã‚¯
## ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒ
ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã®ã‚¹ãƒšãƒƒã‚¯ã¯ä»¥ä¸‹ã®é€šã‚Š

- CPUï¼šIntel(R)Core(TM)i7-8700k 3.70GHz
- ãƒ¡ãƒ¢ãƒªï¼š24.0GB
- GPUï¼šNVIDIA GeForce RTX 2080 Ti

## Google Colaboratory
colaboratoryä¸Šã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ç¢ºèªã—ãŸï¼

```
!cat /proc/cpuinfo # CPU
!free -h # ãƒ¡ãƒ¢ãƒª
!nvidia-smi # GPU
```
å®Ÿè¡Œçµæœã¯ä»¥ä¸‹ã®é€šã‚Š

```
processor	: 0
vendor_id	: GenuineIntel
cpu family	: 6
model		: 85
model name	: Intel(R) Xeon(R) CPU @ 2.00GHz
stepping	: 3
microcode	: 0x1
cpu MHz		: 2000.170
cache size	: 39424 KB
physical id	: 0
siblings	: 2
core id		: 0
cpu cores	: 1
apicid		: 0
initial apicid	: 0
fpu		: yes
fpu_exception	: yes
cpuid level	: 13
wp		: yes
flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ss ht syscall nx pdpe1gb rdtscp lm constant_tsc rep_good nopl xtopology nonstop_tsc cpuid tsc_known_freq pni pclmulqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch invpcid_single ssbd ibrs ibpb stibp fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm mpx avx512f avx512dq rdseed adx smap clflushopt clwb avx512cd avx512bw avx512vl xsaveopt xsavec xgetbv1 xsaves arat md_clear arch_capabilities
bugs		: cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs taa
bogomips	: 4000.34
clflush size	: 64
cache_alignment	: 64
address sizes	: 46 bits physical, 48 bits virtual
power management:

processor	: 1
vendor_id	: GenuineIntel
cpu family	: 6
model		: 85
model name	: Intel(R) Xeon(R) CPU @ 2.00GHz
stepping	: 3
microcode	: 0x1
cpu MHz		: 2000.170
cache size	: 39424 KB
physical id	: 0
siblings	: 2
core id		: 0
cpu cores	: 1
apicid		: 1
initial apicid	: 1
fpu		: yes
fpu_exception	: yes
cpuid level	: 13
wp		: yes
flags		: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ss ht syscall nx pdpe1gb rdtscp lm constant_tsc rep_good nopl xtopology nonstop_tsc cpuid tsc_known_freq pni pclmulqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch invpcid_single ssbd ibrs ibpb stibp fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm mpx avx512f avx512dq rdseed adx smap clflushopt clwb avx512cd avx512bw avx512vl xsaveopt xsavec xgetbv1 xsaves arat md_clear arch_capabilities
bugs		: cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs taa
bogomips	: 4000.34
clflush size	: 64
cache_alignment	: 64
address sizes	: 46 bits physical, 48 bits virtual
power management:

              total        used        free      shared  buff/cache   available
Mem:            12G        571M         10G        944K        2.1G         11G
Swap:            0B          0B          0B
Sun Jul  5 01:59:09 2020       
+-----------------------------------------------------------------------------+
| NVIDIA-SMI 450.36.06    Driver Version: 418.67       CUDA Version: 10.1     |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|                               |                      |               MIG M. |
|===============================+======================+======================|
|   0  Tesla P100-PCIE...  Off  | 00000000:00:04.0 Off |                    0 |
| N/A   35C    P0    28W / 250W |      0MiB / 16280MiB |      0%      Default |
|                               |                      |                 ERR! |
+-------------------------------+----------------------+----------------------+
                                                                               
+-----------------------------------------------------------------------------+
| Processes:                                                                  |
|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |
|        ID   ID                                                   Usage      |
|=============================================================================|
|  No running processes found                                                 |
+-----------------------------------------------------------------------------+
```
# å®Ÿè¡Œé€Ÿåº¦
å®Ÿè¡Œé€Ÿåº¦ã¯å‡¦ç†ã«æ™‚é–“ã‚’è¦ã—ãŸãŸã‚1epochï¼ˆ5688iterï¼‰ã®ã¿ã§æ¯”è¼ƒã™ã‚‹ï¼ä»¥ä¸‹ãŒ1epochã«ã‹ã‹ã£ãŸæ™‚é–“ï¼Œ1iterã‚ãŸã‚Šã®forwardåŠã³backwardã®è¨ˆç®—æ™‚é–“ã§ã‚ã‚‹ï¼

| |Local|Google Colaboratory|
|:-:|:-:|:-:|
|1epochã®å‡¦ç†æ™‚é–“ï¼ˆhï¼‰ |3.5|0.75|
|forwardã®è¨ˆç®—æ™‚é–“ï¼ˆs/iterï¼‰|0.51|0.04|
|backwardã®è¨ˆç®—æ™‚é–“ï¼ˆs/iterï¼‰|1.61|0.41|

1epochã®å‡¦ç†æ™‚é–“ãŒ4.6å€ã»ã©å‡¦ç†ãŒé…ã„â€¦ã“ã®å·®ã¯ã•ã™ãŒã«è¨±å®¹ã§ããªã„ãªã¨æ€ã£ãŸï¼
ã¾ãŸï¼Œforwardã¨backwardã«é–¢ã—ã¦ã¯ï¼Œcolaboratoryã®ã»ã†ã¯forwardã«å¯¾ã—ã¦backwardãŒ10å€ã»ã©è¨ˆç®—æ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã‚‹ã®ã«å¯¾ã—ã¦ï¼Œãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã¯3å€ç¨‹åº¦ã¨ãªã£ã¦ã„ã‚‹ï¼ã“ã‚Œã¨å‡¦ç†é€Ÿåº¦ã®å·®ã«ä½•ã‹é–¢ä¿‚ãŒã‚ã‚‹ã®ã‹æ°—ã«ãªã‚‹ï¼

## åŸå› ã®è€ƒå¯Ÿ
æ­£ç›´ãªã¨ã“ã‚åŸå› ã¯ã‚ã‹ã£ã¦ã„ãªã„ï¼ã—ã‹ã—ï¼Œè€ƒãˆã‚‰ã‚Œã‚‹è¦ç´ ã¨ã—ã¦

- ãƒ­ãƒ¼ã‚«ãƒ«ã¯ä»®æƒ³ç’°å¢ƒä¸Šã§å®Ÿè¡Œã—ã¦ã„ã‚‹
- GPUã®æ€§èƒ½å·®
- CUDA on WSLãŒãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«é–¢ã—ã¦ä¿è¨¼ã—ã¦ã„ãªã„

ã‚ãŸã‚Šã¯åŸå› ã¨ã—ã¦è€ƒãˆã‚‰ã‚Œã‚‹ï¼ã“ã“ã¯ä»Šå¾Œèª¿ã¹ã¦è¡ŒããŸã„ã¨ã“ã‚ã§ã¯ã‚ã‚‹ï¼
# ã¾ã¨ã‚
ç¾çŠ¶ï¼ŒLinuxä¸Šã§æ·±å±¤å­¦ç¿’ã‚’ã‚„ã‚‹ãªã‚‰Google Colaboratoryã«è»é…ãŒä¸ŠãŒã‚‹ï¼ã—ã‹ã—ï¼ŒColaboratoryã¯12æ™‚é–“ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒåˆ‡ã‚Œã¦ã—ã¾ã†ãŸã‚ï¼Œå¤§è¦æ¨¡ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®å­¦ç¿’ã‚’ã™ã‚‹ã«ã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ä¿å­˜ã‚„å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã®ç”¨æ„ç­‰ã‚’è‰²ã€…æ¤œè¨ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã®ãŒãƒãƒƒã‚¯ã§ã‚ã‚‹ï¼
ä»Šå¾Œã‚„ã£ã¦ã„ããŸã„ã“ã¨ã¨ã—ã¦ã¯

- Windowsä¸Šã§å®Ÿè¡Œã—ãŸå ´åˆã¨ä¸Šè¨˜2ã¤ã®æ€§èƒ½æ¯”è¼ƒ
- åŸå› ã®èª¿æŸ»

ã‚’è¡Œã£ã¦ã„ããŸã„ï¼ãã‚Œã§ã‚‚Colaboratoryã®ã»ã†ãŒæ€§èƒ½è‰¯ã‹ã£ãŸã‚‰èª²é‡‘ã‚‚è¦–é‡ã«å…¥ã‚Œã‚ˆã†ã‹ã¨æ€æ¡ˆã—ã¦ã„ã‚‹ï¼

